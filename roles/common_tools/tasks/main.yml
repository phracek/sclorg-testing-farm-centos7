---
- name: Install basic tools
  package:
    name: "{{ item }}"
    state: latest
  with_items:
    - perl
    - git
    - make
    - libseccomp-devel
    - postfix
    - acl

- name: Install podman and podman-docker for CentOS Streams and Fedora
  package:
    name: "{{ item }}"
    state: latest
  with_items:
    - podman
    - podman-docker
  when: releasever > 7

- name: Uninstall podman and podman-docker from CentOS 7
  package:
    name: "{{ item }}"
    state: absent
  with_items:
    - podman
    - podman-docker
  when: releasever == 7

- name: Install basic tools for CentOS 7
  package:
    name: "{{ item }}"
    state: latest
  with_items:
    - rsync
    - docker
    - docker-client
    - docker-common
    - centos-release-scl-rh
    - groff-base
    - centos-release-openshift-origin
    - epel-release
    - rh-python36-python-virtualenv
    - origin-clients
    - python3-pip
    - mailx
  when: releasever == 7

- name: Install Fedora packages
  package:
    name: "{{ item }}"
    state: latest
  with_items:
    - golang-github-cpuguy83-md2man
    - openssl
    - python-pip
    - s-nail
  when: releasever > 30

- name: Install CentOS 7 packages
  package:
    name: "{{ item }}"
    state: latest
    validate_certs: no
    disable_gpg_check: true
  with_items:
    - ca-certificates
    - https://cbs.centos.org/kojifiles/packages/golang-github-cpuguy83-go-md2man/1.0.4/4.0.el7/x86_64/golang-github-cpuguy83-go-md2man-1.0.4-4.0.el7.x86_64.rpm
  when: releasever == 7

- name: Install CentOS Stream 8 packages
  package:
    name: "{{ item }}"
    state: latest
    validate_certs: no
    disable_gpg_check: true
  with_items:
    - https://download-ib01.fedoraproject.org/pub/epel/8/Everything/x86_64/Packages/g/golang-github-cpuguy83-md2man-2.0.0-4.20210612gitaf8da76.el8.x86_64.rpm
    - mailx
  when: releasever == 8

- name: Install CentOS Stream 9 packages
  package:
    name: "{{ item }}"
    state: latest
    validate_certs: no
    disable_gpg_check: true
  with_items:
    - https://kojihub.stream.centos.org/kojifiles/packages/golang-github-cpuguy83-md2man/2.0.0/16.gitaf8da76.el9/x86_64/golang-github-cpuguy83-md2man-2.0.0-16.gitaf8da76.el9.x86_64.rpm
    - s-nail
  when: releasever == 9


- name: Create dir ca for CentOS 7
  file:
    path: /etc/rhsm/ca
    state: directory
    owner: root
    group: root
  when: releasever == 7

- name: ensure file /etc/rhsm/ca/redhat-uep exists
  file:
    path: /etc/rhsm/ca/redhat-uep.pem
    state: touch
    mode: 0644
  when: releasever == 7

- name: Create dir containers for CentOS7
  file:
    path: /etc/containers
    state: directory
    owner: root
    group: root
  when: releasever == 7

- name: Create dir /etc/containers
  file:
    path: /etc/containers
    state: directory
    owner: root
    group: root

- name: ensure file /etc/containers/nodocker exists
  file:
    path: /etc/containers/nodocker
    state: touch
    mode: 0644
